policies:
  - uid: mondoo-vmware-vulnerability
    name: VMware vCenter Vulnerability Policy by Mondoo
    version: "1.0.0"
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: vmware,vmware-esxi
      mondoo.com/category: security
    docs:
      desc: |
        ## Overview

        Mondoo OpenSSL VMware vCenter Policy checks for vulnerable vCenter/ESXi configuration. It should be used in combination with the Platform Vulnerability Policy to identify missing patches.

        ### Run policy

        To run this policy against VMware vCenter:

        ```bash
        cnspec scan vsphere user@domain.local@192.168.5.24 --ask-pass -f core/mondoo-vmware-vulnerability.mql.yaml
        ```

        ## Join the community!

        Our goal is to build policies that are simple to deploy, accurate, and actionable. 
        
        If you have any suggestions on how to improve this policy, or if you need support, [join the community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions.
    specs:
      - asset_filter:
          query: asset.platform == "vmware-esxi"
        scoring_queries:
          mondoo-vmware-vulnerability-slpd-not-running:
queries:
  - uid: mondoo-vmware-vulnerability-slpd-not-running
    title: Ensure the slpd service is not running
    query: vsphere.host.services.none(key == "slpd" && running == true)
    docs:
      desc: |
        In 2021, ESXi 7.0 U2c and ESXi 8.0 GA began shipping with the service disabled by default. 
    refs:
      - title: VMware Security Response Center (vSRC) Response to 'ESXiArgs' Ransomware Attacks
        url: https://blogs.vmware.com/security/2023/02/83330.html
      - title: VMSA-2021-0002
        url: https://www.vmware.com/security/advisories/VMSA-2021-0002.html
      - title: How to Disable/Enable the SLP Service on VMware ESXi (76372)
        url: https://kb.vmware.com/s/article/76372
