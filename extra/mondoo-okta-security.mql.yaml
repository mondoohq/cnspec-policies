policies:
  - uid: mondoo-okta-security
    name: Okta Organization Security
    version: 1.0.0
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.com
    tags:
      mondoo.com/platform: okta-org,saas
      mondoo.com/category: security
    docs:
      desc: |
        # Overview

        The Mondoo Okta Security policy bundle provides security recommendations for Okta organizations.

        ## About remote scanning

        Remote scans with cnspec provide on demand security assessments of infrastructure and services without the need to install any agents or integrations. cnspec comes with a growing list of providers to connect and scan local and remote targets. 

        A complete list of providers can be found by running the following command: 
        
        ```bash
        cnspec scan --help
        ``` 

        ### cnspec Okta provider
        
        This policy uses the `okta` provider to authenticate with Okta's API in order to remotely scan an Okta organization. Additional information on the `okta` provider can be found by running the following command: 
        
        ```bash
        cnspec scan okta --help
        ```
      
        ## Configuring the Okta provider

        The `okta` provider for cnspec requires an API token to authenticate and run scans. 

        ### Create an API token

        To create an API token, see [Create an API token](https://developer.okta.com/docs/guides/create-an-api-token/main/) on Okta's documentation site.
        
        ### Configure a OKTA_TOKEN environment variable

        You supply your API token to cnspec using the `OKTA_TOKEN` environment variable. 

        #### Linux / MacOS

        ```bash
        export OKTA_TOKEN=<OKTA_TOKEN>
        ```

        #### Windows 

        ```powershell
        $Env:OKTA_TOKEN = "<OKTA_TOKEN>"
        ```        

        ## Scan an Okta organization
        
        To scan the configuration of an Okta organization:  

        ```bash
        cnspec scan okta --organization DOMAIN.okta.com --token $OKTA_TOKEN
        ```

        ## Join the community!

        Our goal is to build policies that are simple to deploy, accurate, and actionable. 
        
        If you have any suggestions on how to improve this policy, or if you need support, [join the community](https://github.com/orgs/mondoohq/discussions) in GitHub Discussions.
    specs:
      - asset_filter:
          query: asset.platform == "okta-org"
        scoring_queries:
          mondoo-okta-security-okta-browser-plugin-active:
          mondoo-okta-security-okta-dashboard-active:
          mondoo-okta-security-okta-admin-console-active:

queries:
  # Scoring Queries
  - uid: mondoo-okta-security-okta-admin-console-active
    title: Ensure Okta Admin Console application is active
    query: okta.applications.where( name == "saasure" ).all( status == "ACTIVE")
  - uid: mondoo-okta-security-okta-dashboard-active
    title: Ensure Okta Dashboard application is active
    query: okta.applications.where( name == "okta_enduser" ).all( status == "ACTIVE")
  - uid: mondoo-okta-security-okta-browser-plugin-active
    title: Ensure Okta browser plugin application is active
    query: okta.applications.where( name == "okta_browser_plugin" ).all( status == "ACTIVE")
